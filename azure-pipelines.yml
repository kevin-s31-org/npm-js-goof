# Node.js
# Build a general Node.js project with npm.
# Add steps that analyze code, save build artifacts, deploy, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/javascript

trigger:
  - master

pool:
  vmImage: ubuntu-latest


steps:
  - checkout: self

  - script: |
      npm install -g snyk snyk-to-html
      npm install
      npm fund
  - task: SnykSecurityScan@1
    continueOnError: true
    inputs:
      serviceConnectionEndpoint: 'SNYK_TOKEN'
      testType: 'app'
      # This configures a pure local scan - results are not uploaded. 
      # If this is desired, set `monitorWhen` to 'always' and remove the `--sarif-file-output` argument.

      # If you need to connect to the EU Instance, add --API=https://app.eu.snyk.io/api to additionalArguments
      
      monitorWhen: 'never'
      additionalArguments: '--all-projects --debug'
  - script: | 
     pwd
     ls -l

  - task: PublishHtmlReport@1
    displayName: 'Publish HTML Report'
    inputs:
      reportDir: '$(ResultsPath)/reportName.html'
      tabName: 'Snyk Report'

#  - task: PublishBuildArtifacts@1
#    displayName: "Publish Artifact: CodeAnalysisLogs"
#    condition: succeededOrFailed()
#    inputs:
#      PathtoPublish: $(Build.SourcesDirectory)/CodeAnalysisLogs
#      ArtifactName: CodeAnalysisLogs